/**
 * Fritzguard Translation System
 * Supports: English (en), Dutch/Nederlands (nl), French (fr)
 */

const translations = {
  en: {
    // Navigation & Header
    "nav.menu": "Menu",
    "nav.home": "Home",
    "nav.story": "Story",
    "nav.dishes": "Dishes",
    "nav.jobs": "Jobs",
    "nav.locations": "Locations",
    "nav.contact": "Collaboration",

    // Hero Section
    "hero.title": "Fritzguard",
    "hero.subtitle": "luxury frites",
    "hero.est": "Est.",
    "hero.year": "2022",

    // Story Section
    "story.heading": "our story",
    "story.title": "The Best In Belgium",
    "story.founding": "Born in 2022",
    "story.location": "in the heart of Brussels, facing the Bourse, Fritzguard Brussels is a family passion project.",
    "story.concept": "We envisioned a reimagined Belgian üáßüá™ cuisine built around a unique concept: loaded fries topped with great Belgian classics",
    "story.concept_end": "reinterpreted with precision and creativity.",
    "story.recipes": "Vol-au-vent, beef cheeks, Li√®ge-style meatballs, moules-frites‚Ä¶ and much more: each recipe was created, tested, and perfected over nearly two years, alongside experienced chefs.",
    "story.burgers": "Our menu also features premium burgers made with quality Angus beef and chicken, as well as vegetarian alternatives such as our cauliflower burgers, to satisfy every taste.",
    "story.quality": "At Fritzguard, everything is homemade, with no frozen products, using only fresh, local, and 100% Belgian üáßüá™ ingredients.",
    "story.design": "Designed in collaboration with renowned designers and architects, the project combines authenticity, modernity, and craftsmanship.",
    "story.today": "Today, Fritzguard has become a must-visit address in Brussels, with the ambition to grow while never betraying its DNA: quality above all.",

    // Menu Section
    "menu.label": "Menu",
    "menu.title": "signature dishes",
    "menu.button": "discover full menu",
    "menu.description": "Vol-au-vent, beef cheeks, Li√®ge-style meatballs, moules-frites‚Ä¶ and much more: each recipe was created, tested, and perfected over nearly two years, alongside experienced chefs.\n\nOur menu also features premium burgers made with quality Angus beef and chicken, as well as vegetarian alternatives such as our cauliflower burgers, to satisfy every taste.",

    // Jobs Section
    "jobs.heading": "Jobs",
    "jobs.title": "Join our Team",
    "jobs.paragraph1": "We're always looking for passionate individuals who share our commitment to excellence and quality. Whether you're a chef, kitchen staff, server, or part of our team, we believe in creating an environment where everyone can grow and thrive.",
    "jobs.paragraph2": "At Fritzguard, we don't just serve frites‚Äîwe serve an experience. Join us and be part of a team that's dedicated to perfecting every detail, from sourcing the finest Belgian üáßüá™ ingredients to delivering exceptional service to our guests.",
    "jobs.interested": "Interested in joining our team?",
    "jobs.contact": "We'd love to hear from you! Feel free to reach out to us at",
    "jobs.phone": "+32 2 331 00 29",
    "jobs.email": "beloria.contact@gmail.com",
    "jobs.closing": "Let's create something exceptional together!",

    // Locations Section
    "locations.heading": "locations",
    "locations.title": "Visit Us",
    "locations.address": "Address",
    "locations.phone": "Phone",
    "locations.email": "Email",

    // Browser Title
    "browser.title": "Your frites are getting cold!",

    // Footer
    "footer.year": "All rights reserved",
    "footer.contact": "Contact",
    "footer.followUs": "Follow Us",

    // Accessibility
    "video.noSupport": "Your browser does not support the video tag."
  },

  nl: {
    // Navigation & Header
    "nav.menu": "Menu",
    "nav.home": "Startpagina",
    "nav.story": "Verhaal",
    "nav.dishes": "Gerechten",
    "nav.jobs": "Vacatures",
    "nav.locations": "Locaties",
    "nav.contact": "Samenwerking",

    // Hero Section
    "hero.title": "Fritzguard",
    "hero.subtitle": "luxe frites",
    "hero.est": "Est.",
    "hero.year": "2022",

    // Story Section
    "story.heading": "ons verhaal",
    "story.title": "Het Beste van Belgi√´",
    "story.founding": "Opgericht in 2022",
    "story.location": "in het hart van Brussel, tegenover de Beurs, is Fritzguard Brussel een familiepassieproject.",
    "story.concept": "We bedachten een vernieuwde Belgische üáßüá™ keuken rond een uniek concept: frietjes beladen met grote Belgische klassieken",
    "story.concept_end": "opnieuw ge√Ønterpreteerd met precisie en creativiteit.",
    "story.recipes": "Vol-au-vent, runderangen, Luikse balletjes, moules-frites‚Ä¶ en nog veel meer: elk recept werd bijna twee jaar lang gecre√´erd, getest en geperfectioneerd, samen met ervaren chefs.",
    "story.burgers": "Ons menu bevat ook premiumburgers van kwaliteit Angus-rundvlees en kip, evenals vegetarische alternatieven zoals onze bloemkoolburgers, om elke smaak tevreden te stellen.",
    "story.quality": "Bij Fritzguard is alles huisgemaakt, zonder bevroren producten, met alleen verse, lokale en 100% Belgische üáßüá™ ingredi√´nten.",
    "story.design": "Ontworpen in samenwerking met gerenommeerde ontwerpers en architecten, combineert het project authenticiteit, moderniteit en vakmanschap.",
    "story.today": "Vandaag is Fritzguard een must-visit-adres in Brussel geworden, met de ambitie om te groeien zonder zijn DNA te verraden: kwaliteit bovenal.",

    // Menu Section
    "menu.label": "Menu",
    "menu.title": "signature gerechten",
    "menu.button": "ontdek volledige menu",
    "menu.description": "Vol-au-vent, runderangen, Luikse balletjes, moules-frites‚Ä¶ en nog veel meer: elk recept werd bijna twee jaar lang gecre√´erd, getest en geperfectioneerd, samen met ervaren chefs.\n\nOns menu bevat ook premiumburgers van kwaliteit Angus-rundvlees en kip, evenals vegetarische alternatieven zoals onze bloemkoolburgers, om elke smaak tevreden te stellen.",

    // Jobs Section
    "jobs.heading": "Vacatures",
    "jobs.title": "Sluit Je Bij Ons Team Aan",
    "jobs.paragraph1": "We zoeken altijd naar gepassioneerde personen die ons engagement voor excellentie en kwaliteit delen. Of je nu chef bent, keukenmedewerker, server of onderdeel van ons team, we geloven in het cre√´ren van een omgeving waarin iedereen kan groeien en floreren.",
    "jobs.paragraph2": "Bij Fritzguard serveren we niet zomaar frites‚Äîwe serveren een ervaring. Sluit je bij ons aan en maak deel uit van een team dat zich inzet voor het perfectioneren van elk detail, van het zoeken van de fijnste Belgische üáßüá™ ingredi√´nten tot het leveren van uitzonderlijke service aan onze gasten.",
    "jobs.interested": "Ge√Ønteresseerd in het joinen van ons team?",
    "jobs.contact": "We horen graag van je! Voel je vrij om ons te bereiken op",
    "jobs.phone": "+32 2 331 00 29",
    "jobs.email": "beloria.contact@gmail.com",
    "jobs.closing": "Laten we samen iets uitzonderlijks cre√´ren!",

    // Locations Section
    "locations.heading": "locaties",
    "locations.title": "Bezoek Ons",
    "locations.address": "Adres",
    "locations.phone": "Telefoonnummer",
    "locations.email": "E-mailadres",

    // Browser Title
    "browser.title": "Je frites worden koud!",

    // Footer
    "footer.year": "Alle rechten voorbehouden",
    "footer.contact": "Contact",
    "footer.followUs": "Volg Ons",

    // Accessibility
    "video.noSupport": "Je browser ondersteunt de videotag niet."
  },

  fr: {
    // Navigation & Header
    "nav.menu": "Menu",
    "nav.home": "Accueil",
    "nav.story": "Notre histoire",
    "nav.dishes": "Plats",
    "nav.jobs": "Emplois",
    "nav.locations": "Emplacement",
    "nav.contact": "Collaboration",

    // Hero Section
    "hero.title": "Fritzguard",
    "hero.subtitle": "frites de luxe",
    "hero.est": "Fond√©e",
    "hero.year": "2022",

    // Story Section
    "story.heading": "notre histoire",
    "story.title": "Le Meilleur de la Belgique",
    "story.founding": "Fond√©e en 2022",
    "story.location": "au c≈ìur de Bruxelles, face √† la Bourse, Fritzguard Bruxelles est un projet passionnel familial.",
    "story.concept": "Nous avons imagin√© une cuisine belge üáßüá™ r√©invent√©e construite autour d'un concept unique : des frites charg√©es garnie de grands classiques belges",
    "story.concept_end": "r√©interpr√©t√©s avec pr√©cision et cr√©ativit√©.",
    "story.recipes": "Vol-au-vent, joues de b≈ìuf, boulettes √† la li√©geoise, moules-frites‚Ä¶ et bien d'autres : chaque recette a √©t√© cr√©√©e, test√©e et perfectionn√©e pendant pr√®s de deux ans, aux c√¥t√©s de chefs exp√©riment√©s.",
    "story.burgers": "Notre menu propose √©galement des burgers premium √† base de b≈ìuf Angus de qualit√© et de poulet, ainsi que des alternatives v√©g√©tariennes comme nos burgers au chou-fleur, pour satisfaire tous les palais.",
    "story.quality": "Chez Fritzguard, tout est fait maison, sans produits surgel√©s, en utilisant uniquement des ingr√©dients frais, locaux et 100% belges üáßüá™.",
    "story.design": "Con√ßu en collaboration avec des designers et architectes renomm√©s, le projet combine authenticit√©, modernit√© et artisanat.",
    "story.today": "Aujourd'hui, Fritzguard est devenu une adresse incontournable de Bruxelles, avec l'ambition de grandir sans jamais trahir son ADN : la qualit√© avant tout.",

    // Menu Section
    "menu.label": "Menu",
    "menu.title": "plats signature",
    "menu.button": "d√©couvrir le menu complet",
    "menu.description": "Vol-au-vent, joues de b≈ìuf, boulettes √† la li√©geoise, moules-frites‚Ä¶ et bien d'autres : chaque recette a √©t√© cr√©√©e, test√©e et perfectionn√©e pendant pr√®s de deux ans, aux c√¥t√©s de chefs exp√©riment√©s.\n\nNotre menu propose √©galement des burgers premium √† base de b≈ìuf Angus de qualit√© et de poulet, ainsi que des alternatives v√©g√©tariennes comme nos burgers au chou-fleur, pour satisfaire tous les palais.",

    // Jobs Section
    "jobs.heading": "Emplois",
    "jobs.title": "Rejoignez Notre √âquipe",
    "jobs.paragraph1": "Nous recherchons toujours des individus passionn√©s qui partagent notre engagement envers l'excellence et la qualit√©. Que vous soyez chef, personnel de cuisine, serveur ou membre de notre √©quipe, nous croyons en la cr√©ation d'un environnement o√π chacun peut s'√©panouir.",
    "jobs.paragraph2": "Chez Fritzguard, nous ne servons pas que des frites‚Äînous servons une exp√©rience. Rejoignez-nous et faites partie d'une √©quipe d√©vou√©e √† perfectionner chaque d√©tail, de l'approvisionnement des plus beaux ingr√©dients belges üáßüá™ √† la prestation d'un service exceptionnel √† nos clients.",
    "jobs.interested": "Int√©ress√© par rejoindre notre √©quipe ?",
    "jobs.contact": "Nous aimerions avoir de vos nouvelles ! N'h√©sitez pas √† nous contacter √†",
    "jobs.phone": "+32 2 331 00 29",
    "jobs.email": "beloria.contact@gmail.com",
    "jobs.closing": "Cr√©ons quelque chose d'exceptionnel ensemble !",

    // Locations Section
    "locations.heading": "localit√©s",
    "locations.title": "Visitez-nous",
    "locations.address": "Adresse",
    "locations.phone": "T√©l√©phone",
    "locations.email": "E-mail",

    // Browser Title
    "browser.title": "Vos frites refroidissent !",

    // Footer
    "footer.year": "Tous droits r√©serv√©s",
    "footer.contact": "Contact",
    "footer.followUs": "Suivez-nous",

    // Accessibility
    "video.noSupport": "Votre navigateur ne supporte pas la balise vid√©o."
  }
};

/**
 * Translation Manager Class
 */
class TranslationManager {
  constructor(defaultLanguage = 'en') {
    this.currentLanguage = defaultLanguage;
    this.translations = translations;
    this.defaultLanguage = defaultLanguage;
  }

  /**
   * Get a translated string by key
   * @param {string} key - Translation key (e.g., 'hero.title')
   * @param {string} language - Optional language code (defaults to current language)
   * @returns {string} Translated text or key if not found
   */
  get(key, language = null) {
    const lang = language || this.currentLanguage;
    
    if (this.translations[lang] && this.translations[lang][key]) {
      return this.translations[lang][key];
    }
    
    // Fallback to default language
    if (this.translations[this.defaultLanguage] && this.translations[this.defaultLanguage][key]) {
      return this.translations[this.defaultLanguage][key];
    }
    
    console.warn(`Translation not found for key: ${key}`);
    return key;
  }

  /**
   * Set the current language
   * @param {string} language - Language code (en, nl, fr)
   */
  setLanguage(language) {
    if (this.translations[language]) {
      this.currentLanguage = language;
      localStorage.setItem('fritzguard_language', language);
      console.log('Translation: Language changed to:', language);
      this.updatePageTranslations();
      return true;
    }
    console.warn('Translation: Language not supported:', language);
    return false;
  }

  /**
   * Get current language
   * @returns {string} Current language code
   */
  getLanguage() {
    return this.currentLanguage;
  }

  /**
   * Get all available languages
   * @returns {string[]} Array of language codes
   */
  getAvailableLanguages() {
    return Object.keys(this.translations);
  }

  /**
   * Update all elements with data-i18n attribute
   * This function traverses the DOM and updates all elements with translation keys
   */
  updatePageTranslations() {
    const elements = document.querySelectorAll('[data-i18n]');
    
    elements.forEach((element) => {
      const key = element.getAttribute('data-i18n');
      const translation = this.get(key);
      
      // Check if element should have translation in specific attribute
      const attr = element.getAttribute('data-i18n-attr');
      
      if (attr) {
        // Update specific attribute
        element.setAttribute(attr, translation);
      } else {
        // Update text content
        element.textContent = translation;
      }
    });

    // Update HTML title
    const titleKey = document.documentElement.getAttribute('data-i18n-title');
    if (titleKey) {
      document.title = this.get(titleKey);
    }

    // Dispatch custom event for other scripts to listen
    window.dispatchEvent(new CustomEvent('languageChanged', { 
      detail: { language: this.currentLanguage } 
    }));
  }

  /**
   * Initialize translation manager from localStorage or browser language
   */
  initialize() {
    // Check localStorage for saved language
    const savedLanguage = localStorage.getItem('fritzguard_language');
    
    if (savedLanguage && this.translations[savedLanguage]) {
      this.currentLanguage = savedLanguage;
      console.log('Translation: Loaded saved language from localStorage:', savedLanguage);
    } else {
      // Try to use browser language
      const browserLang = navigator.language.substring(0, 2);
      if (this.translations[browserLang]) {
        this.currentLanguage = browserLang;
        console.log('Translation: Detected browser language:', browserLang);
      } else {
        console.log('Translation: Browser language not supported, using default: en');
      }
    }

    // Update page translations
    this.updatePageTranslations();
  }

  /**
   * Translate a key and optionally replace variables
   * @param {string} key - Translation key
   * @param {object} variables - Variables to replace in translation (optional)
   * @returns {string} Translated text with variables replaced
   */
  translate(key, variables = {}) {
    let text = this.get(key);
    
    // Replace variables in format {variableName}
    Object.keys(variables).forEach((varName) => {
      text = text.replace(new RegExp(`{${varName}}`, 'g'), variables[varName]);
    });
    
    return text;
  }
}

// Create global instance
window.i18n = new TranslationManager('en');

// Initialize when DOM is ready
if (document.readyState === 'loading') {
  document.addEventListener('DOMContentLoaded', () => {
    console.log('DOMContentLoaded - Starting initialization');
    window.i18n.initialize();
    // Ensure buttons are rendered before setting up switcher
    setTimeout(() => {
      console.log('Setting up language switcher, current lang:', window.i18n.getLanguage());
      setupLanguageSwitcher();
    }, 50);
  });
} else {
  console.log('DOM already loaded - Starting initialization');
  window.i18n.initialize();
  // Ensure buttons are rendered before setting up switcher
  setTimeout(() => {
    console.log('Setting up language switcher, current lang:', window.i18n.getLanguage());
    setupLanguageSwitcher();
  }, 50);
}

/**
 * Setup language switcher UI
 * Connects the existing language switcher buttons to the translation system
 */
function setupLanguageSwitcher() {
  const langSwitchers = document.querySelectorAll('.lang-switcher_wrapper [data-lang]');
  console.log('Found language switcher buttons:', langSwitchers.length);
  
  if (langSwitchers.length === 0) {
    console.warn('‚ö†Ô∏è Language switcher elements not found in DOM');
    console.warn('Looking for: .lang-switcher_wrapper [data-lang]');
    return;
  }
  
  // First, update active button state
  updateActiveLangButton();
  
  // Then attach click listeners
  langSwitchers.forEach((langButton) => {
    langButton.addEventListener('click', function (e) {
      e.preventDefault();
      const selectedLang = this.getAttribute('data-lang');
      console.log('Language button clicked:', selectedLang);
      window.i18n.setLanguage(selectedLang);
      updateActiveLangButton();
    });
  });
  
  console.log('‚úì Language switcher setup complete');
}

/**
 * Update active language button styling based on current language
 * Reads from localStorage and applies .active class to matching button
 */
function updateActiveLangButton() {
  const currentLang = window.i18n.getLanguage();
  const langButtons = document.querySelectorAll('.lang-switcher_wrapper [data-lang]');
  
  console.log('updateActiveLangButton() - Current language:', currentLang);
  console.log('updateActiveLangButton() - Found buttons:', langButtons.length);
  
  if (langButtons.length === 0) {
    console.warn('‚ö†Ô∏è No language buttons found to update');
    return;
  }
  
  let foundActive = false;
  langButtons.forEach((button) => {
    const buttonLang = button.getAttribute('data-lang');
    button.classList.remove('active');
    
    if (buttonLang === currentLang) {
      button.classList.add('active');
      foundActive = true;
      console.log('‚úì Added .active class to button:', buttonLang);
    }
  });
  
  if (!foundActive) {
    console.warn('‚ö†Ô∏è No matching button found for language:', currentLang);
  }
}

// Export for module systems
if (typeof module !== 'undefined' && module.exports) {
  module.exports = { TranslationManager, translations };
}
